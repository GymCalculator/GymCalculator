<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">


<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
          integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <meta charset="UTF-8">
    <title>GymCalculator</title>
    <script th:inline="javascript">
        var listOfCheckedItems = [];
    </script>
</head>
<body class="bg-secondary ">
<!--Navigation bar-->
<div th:replace="/fragments/nav :: navbar"></div>
<th:block>
    <div class="container " style="border-radius: 50px;">
        <section class="jumbotron text-center mt-4">
            <div class="bg-light  rounded-pill p-4">
                <h1 class="jumbotron-heading text-info">WEB PROGRAMMING Lifts Calculator</h1>
                <h2 class="jumbotron-heading text-indigo">
                    <i class="fab fa-github" style="font-size:36px"></i>MarkoZoreski
                    <i class="fab fa-github" style="font-size:36px"></i>NikolaGilev
                </h2>
            </div>
        </section>


        <div sec:authorize="isAuthenticated()">
            <div class="row bg-light p-5 mt-4" style="border-radius: 50px;">

                <div class="card col-md-4 p-4 ">
                    <h2 class="text-info">LATEST SAVED LIFTS</h2>
                    <hr>
                                    <div class="row">
                                        <p class="badge bg-primary text-indigo " th:if="${currentUser.findMostRecentLoggedLift()} == null"> You dont have any Lifts Saved</p>
                                        <ul style="list-style:none" th:if="${currentUser.findMostRecentLoggedLift()} != null ">
                                            <li>
                                                <p class="col-12 fst-italic" th:text="'Logged on ' + ${currentUser.findMostRecentLoggedLift().getLoggedDate()} + ':'"></p>
                                            </li>
                                            <li class="col-12">
                                                <span class="fw-bold">Bodyweight:</span>
                                                <span  th:text="${currentUser.getBodyweight()} + ${currentUser.getUnitValue()}"></span>
                                            </li>
                                            <li class="col-12">
                                                <span class="fw-bold">Age:</span>
                                                <span  th:text="${currentUser.getUserAge()}"></span>
                                            </li>
                                            <th:block th:each="exercise : ${currentUser.findMostRecentLoggedLift().getExercises()}">
                                                <li>
                                                    <span class="fw-bold" th:text="${exercise.getExerciseName()} + ': '"></span>
                                                    <span th:text="${exercise.getWeight()} + ${currentUser.getUnitValue()} + ' x ' + ${exercise.getReps()}"></span>
                                                </li>
                                            </th:block>
                                        </ul>
                                    </div>
                </div>

                <div class="card col-md-8 p-4">
                    <h2 class="text-info">Friends</h2>
                    <hr>
                    <div th:if="${currentUser.getFriends().size()} < 1 ">
                        <p class="badge bg-primary text-indigo d-flex justify-content-center">You haven't added any friends yet! Add a friend by
                            entering
                            their username below.</p>
                    </div>
                    <div th:if="${currentUser.getFriends().size()} > 0 ">
                        <table class="table table-striped table-bordered small ">
                            <thead>
                            <tr>
                                <th scope="col">User</th>
                                <th scope="col">Bodyweight</th>
                                <th scope="col">Squat</th>
                                <th scope="col">Floor Pull</th>
                                <th scope="col">Hor. Press</th>
                                <th scope="col">Vert. Press</th>
                                <th scope="col">Pull-up / Row</th>
                                <th scope="col">Total</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="user : ${currentUser.getFriends()}">
                                <td th:text="${user.getUsername()}"></td>
                                    <td th:text="${currentUser.getBodyweight()} + ${currentUser.getUnitValue()}"></td>
                                <th:block th:each="category : ${categories}">
                                    <th:block th:if="${user.findMostRecentLoggedLift()} != null">
                                        <th:block
                                                th:each="exercise : ${user.findMostRecentLoggedLift().getExercises()}">
                                            <th:block
                                                    th:if="${exercise.getCategoryName()} == ${category.getCategoryName()}">
                                                <th th:text="${exercise.getCategoryName()}"></th>
                                            </th:block>
                                        </th:block>
                                    </th:block>
                                </th:block>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <form class="mt-auto" th:action="@{/addFriend/}" th:method="POST">
                        <input type="text" id="friend" name="friend" placeholder="Username"/>
                        <button class="btn btn-success" type="submit">Add Friend <i class="fa fa-plus-circle"></i></button>
                    </form>
                </div>
            </div>
        </div>

        <div class="bg-light container mt-4 p-4 " style="border-radius: 50px">

            <form th:action="@{/homepage}" th:method="POST">

                <h3 class="text-start text-info fw-bolder">Log your latest lifts</h3>
                <hr>
                <div class="row">

                    <div class="col-md-2 m-3">
                        <label for="units" class="label text-dark" style="left: 25%">Units:</label>
                        <select class="btn btn-indigo form-select border-info border-2 text-center "
                                id="units" name="units" style="height: 55px">
                            <option th:each="u:${units}" th:value="${u}" th:text="${u}"></option>

                        </select>
                    </div>


                    <div class="col-md-4 m-3">
                        <label for="nearest" class="label text-dark ">Round calculations to nearest:</label>
                        <select class="btn btn-indigo form-select border-info border-2 " id="nearest"
                                style="height: 55px">
                            <option th:value="1" th:text="'1 kg'"></option>
                            <option th:value="2.5" th:text="'2.5 kg'"></option>
                            <option th:value="5" th:text="'5 kg'"></option>
                            <option th:value="10" th:text="'10 kg'"></option>
                        </select>
                    </div>

                </div>

                <hr>


                <h1 class="text-start text-info ">Select the lifts that you train.</h1>
                <p class="text-start opacity-50">These lifts will be used to determine your strength levels. For the
                    most
                    complete results, choose at least one lift per category</p>

                <!--       Exercises to select from...      -->
                <div class="row">
                    <div class="card d-flex flex-column col-4 mb-4" id="formtest" th:each="category : ${categories}">
                        <label th:for="${category.getCategoryName()}" class="label label-info fw-bold"
                               th:text="${category.getCategoryName()}"></label>
                        <div class="form-check checkbox icheck-indigo" th:each="exercise : ${category.getExercises()}">
                            <input class="form-check-input" type="checkbox" th:checked="${exercise.getChecked()}"
                                   th:id="${exercise.getExerciseName()}" th:value="${exercise.getExerciseName()}"
                                   th:onclick="ShowFunc([[${exercise.getExerciseName()}]])"
                                   name="listCheckedExercises"
                                   id="listCheckedExercises">
                            <label class="form-check-label" th:for="${exercise.getExerciseName()}"
                                   th:text="${exercise.getExerciseName()}"></label>
                        </div>
                        <div class="mt-auto mb-2" id="createExercise" sec:authorize="hasRole('ROLE_ADMIN')">
                            <a class="btn btn-danger"
                               th:href="@{/addNewExercise(category=${category.getCategoryName()})}"
                            >Create new Exercise <i class='fa-solid fa-dumbbell'></i></a>
                        </div>
                    </div>
                    <div class="col-4" id="createCategory" sec:authorize="hasRole('ROLE_ADMIN')">
                        <a type="button" class="btn btn-danger btn-sm" href="/addNewCategory">Create new Category <i class="fa-solid fa-pencil"></i></a>
                    </div>
                </div>
                <!--    Personal info...   -->

                <h1 class="text-start text-info mt-0">Enter your sex, bodyweight, & age.</h1>
                <p class="text-start opacity-50">Your strength score adjusts by sex, bodyweight, and age,
                    allowing you to measure yourself against any other lifter.</p>

                <div class="row">
                    <div class="col-md-2 m-3">
                        <label for="sex" class="label text-wrap text-dark" style="left: 15px">Sex</label>
                        <select class="btn btn-indigo form-select border-info border-2    " id="sex"
                                name="sex" style="height: 55px">
                            <option th:each="s:${sex}" th:value="${s}" th:text="${s}"></option>
                        </select>
                    </div>

                    <div class="col-md-2 m-3">
                        <label for="bw" class="label text-wrap text-dark" style="left: 15px">Body weight</label>
                        <div class="input-group">
                            <input type="number" name="bw" required
                                   class="btn btn-indigo border-info border-2 form-select text-black form-control bg-indigo"
                                   id="bw" min="1" style="height: 55px">
                            <span class="mt-3" th:text="${currentUser.getUnitValue()}"></span>
                        </div>
                    </div>

                    <div class="col-md-2 m-3">
                        <label for="age" class="label text-wrap text-dark" style="left: 15px">Age (optional)</label>
                        <input type="number" class="btn btn-indigo border-info border-2 form-select text-black "
                               id="age" min="1" name="age"
                               style="height: 55px">
                    </div>

                </div>
                <hr>

                <h1 class="text-start text-info mt-0">Enter your best recent sets.</h1>
                <p class="text-start opacity-50">Finally, for each lift you train, enter your most difficult set
                    that you have completed recently. Each set should be 10 or fewer reps.</p>

                <div id="formtest">
                    <div class=" d-flex flex-column" th:each="category : ${categories}">
                        <div class="form-check checkbox icheck-indigo p-4 mb-2"
                             th:each="exercise : ${category.getExercises()}" style="display: none;"
                             th:id="${exercise.getExerciseName()}+'1'">

                            <label th:for="${category.getCategoryName()}" class="label label-info fw-bold"
                                   th:text="${category.getCategoryName()}"></label>
                            <input id="categoryName" name="categoryName" style="display: none"
                                   th:value="${category.getCategoryName()}">

                            <div class="row">

                                <div class="col-md-2 mt-2">
                                    <label class="form-check-label mt-4"
                                           th:text="${exercise.getExerciseName()}"></label>
                                    <input style="display: none" id="exName" name="exName"
                                           th:value="${exercise.getExerciseName()}">


                                </div>
                                <div class="col-md-3">
                                    <label for="age" class="label text-wrap text-dark"
                                           style="left: 15px">Weight</label>

                                    <input type="number" id="exWeight" name="exWeight"
                                           class="btn btn-indigo border-info border-2 form-select text-black "
                                           style="height: 55px">
                                </div>
                                <div class="col-md-3">
                                    <label for="age" class="label text-wrap text-dark"
                                           style="left: 15px">Reps</label>

                                    <input type="number" id="exReps" name="exReps"
                                           class="btn btn-indigo border-info border-2 form-select text-black "
                                           style="height: 55px">
                                </div>

                            </div>

                        </div>
                    </div>
                </div>


                <!-- todo: maybe put a reset button later
                == reset button sets the changed inputs to their predefined values (inserted by the user when creating an account)-->

                <button type="submit" class="btn btn-danger text-white" id="Analyze" name="Analyze">Analyze</button>
                <button type="submit" class="btn btn-info text-white" id="AnalyzeAndSave" name="AnalyzeAndSave">Analyze and Log Lifts
                </button>
                <button type="button" class="blockquote"
                        onclick="{document.getElementById('info').hidden = !document.getElementById('info').hidden.valueOf(); }">
                    ?
                </button>

                <div hidden class="border border-info text-black p-4" id="info" style="background: #86b7fe;">
            <span><b>Analyze:</b> Displays a strength analysis, but does not save the data you entered.
                Use this if you're just curious about some results.</span>
                    <br>

                    <span><b>Analyze and Log Lifts:</b> Displays a strength analysis and saves the data you entered.
                Use this if the numbers you entered match your recent lifts.</span>
                    <br>
                    <span><b>Reset:</b> Loads your last logged lifts.</span>
                </div>


            </form>
        </div>

    </div>
    </div>
    </div>
</th:block>


<script>
    window.onload = function () {
        if (listOfCheckedItems.length === 0) {
            document.getElementById('formtest').style.display = 'none';
            document.getElementById('AnalyzeAndSave').setAttribute('disabled','true');
            document.getElementById('Analyze').setAttribute('disabled','true');


        } else {
            document.getElementById('formtest').style.display = '';
        }


    };

    function ShowFunc(exId) {
        var exId1 = document.getElementById(exId + '1');



        if (listOfCheckedItems.includes(exId)) {
            var idx = listOfCheckedItems.indexOf(exId);
            delete listOfCheckedItems[idx];
            listOfCheckedItems = listOfCheckedItems.filter(item => item !== "");

            exId1.style.display = 'none';

            for (let i = 0; i < 4; i++) {
                exId1.getElementsByTagName('INPUT')[i].removeAttribute('required');
                console.log(exId1.getElementsByTagName('INPUT')[i]);
            }

        } else {
            listOfCheckedItems.push(exId);
            exId1.style.display = '';

            for (let i = 0; i < 4; i++) {
                exId1.getElementsByTagName('INPUT')[i].setAttribute('required', '');
                console.log(exId1.getElementsByTagName('INPUT')[i]);

            }
        }


        if (listOfCheckedItems.length === 0) {
            document.getElementById('formtest').style.display = 'none';
            document.getElementById('AnalyzeAndSave').setAttribute('disabled','true');
            document.getElementById('Analyze').setAttribute('disabled','true');

        } else {
            document.getElementById('formtest').style.display = '';
            document.getElementById('AnalyzeAndSave').removeAttribute('disabled');
            document.getElementById('Analyze').removeAttribute('disabled');

        }


        console.log();
        console.log(exId);
        console.log(listOfCheckedItems);
    }


    $(document).ready(function () {
        $("#myBtn").click(function () {
            $("#myModal").modal();
        });
    });

</script>

</body>
</html>